{"version":3,"sources":["../node_modules/pdfjs-dist/build sync","component/Viewer/PDF.js"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","pdfjs","GlobalWorkerOptions","workerSrc","version","useStyles","makeStyles","theme","layout","marginTop","marginLeft","spacing","marginRight","breakpoints","up","maxWidth","canvas","width","height","borderRadius","paper","marginBottom","PDFViewer","math","useRouteMatch","location","useLocation","query","URLSearchParams","search","useParams","useState","pageNumber","setPageNumber","dispatch","useDispatch","SetSubTitle","useCallback","title","changeSubTitle","ToggleSnackbar","vertical","horizontal","msg","color","toggleSnackbar","useEffect","pathHelper","isSharePage","pathname","get","path","split","length","params","removeTextLayerOffset","document","querySelectorAll","forEach","layer","style","display","classes","className","onLoadSuccess","numPages","onLoadError","error","message","loading","elevation","file","getBaseURL","encodeURIComponent","Array","from","el","index","key","renderAnnotationLayer"],"mappings":"0HAAA,SAASA,EAAoBC,GAC5B,IAAIC,EAAI,IAAIC,MAAM,uBAAyBF,EAAM,KAEjD,MADAC,EAAEE,KAAO,mBACHF,EAEPF,EAAoBK,KAAO,WAAa,MAAO,IAC/CL,EAAoBM,QAAUN,EAC9BO,EAAOC,QAAUR,EACjBA,EAAoBS,GAAK,M,+SCGzBC,QAAMC,oBAAoBC,UAA1B,sCAAqEF,QAAMG,QAA3E,kBAEA,IAAMC,EAAYC,aAAW,SAACC,GAAD,YAAY,CACrCC,QAAM,GACFC,UAAW,OACXC,WAAYH,EAAMI,QAAQ,GAC1BC,YAAaL,EAAMI,QAAQ,IAHzB,cAIDJ,EAAMM,YAAYC,GAAG,KAA0B,EAAnBP,EAAMI,QAAQ,IAAU,CACjDI,SAAU,IACVL,WAAY,OACZE,YAAa,SAPf,6BASY,IATZ,GAWN,UAAW,CACPI,OAAQ,CACJC,MAAO,kBACPC,OAAQ,kBACRC,aAAc,IAGtBC,MAAO,CACHC,aAAcd,EAAMI,QAAQ,QAQrB,SAASW,IACpB,IAAMC,EAAOC,cACPC,EAAWC,cACXC,EANC,IAAIC,gBAAgBF,cAAcG,QAOjC7B,EAAO8B,cAAP9B,GAJwB,EAMI+B,mBAAS,GANb,mBAMzBC,EANyB,KAMbC,EANa,KAQ1BC,EAAWC,cACXC,EAAcC,uBAChB,SAACC,GAAD,OAAWJ,EAASK,YAAeD,MACnC,CAACJ,IAECM,EAAiBH,uBACnB,SAACI,EAAUC,EAAYC,EAAKC,GAA5B,OACIV,EAASW,YAAeJ,EAAUC,EAAYC,EAAKC,MACvD,CAACV,IAGLY,qBAAU,WACN,GAAKC,IAAWC,YAAYvB,EAASwB,UAIjCb,EAAYT,EAAMuB,IAAI,aAJsB,CAC5C,IAAMC,EAAOxB,EAAMuB,IAAI,KAAKE,MAAM,KAClChB,EAAYe,EAAKA,EAAKE,OAAS,OAKpC,CAAC9B,EAAK+B,OAAO,GAAI7B,IAEpB,IAAM8B,EAAwB,WACPC,SAASC,iBACxB,iCAEOC,SAAQ,SAACC,GACEA,EAAVC,MACFC,QAAU,WAIlBC,EAAUzD,IAChB,OACI,yBAAK0D,UAAWD,EAAQtD,QACpB,kBAAC,WAAD,CACIwD,cAAe,gBAAGC,EAAH,EAAGA,SAAH,OAAkBhC,EAAcgC,IAC/CC,YAAa,SAACC,GACV3B,EACI,MACA,QACA,qCAAc2B,EAAMC,QACpB,UAGRC,QACI,kBAAC,IAAD,CAAON,UAAWD,EAAQ1C,MAAOkD,UAAW,GACxC,kBAAC,IAAD,OAGRC,KACIC,eACCzB,IAAWC,YAAYvB,EAASwB,UAC3B,kBACAjD,GAC6B,KAA5B2B,EAAMuB,IAAI,cACL,SACAuB,mBAAmB9C,EAAMuB,IAAI,eAC7B,IACN,iBAAmBvB,EAAMuB,IAAI,QAGtCwB,MAAMC,KAAK,IAAID,MAAM1C,IAAa,SAAC4C,EAAIC,GAAL,OAC/B,kBAAC,IAAD,CAAOd,UAAWD,EAAQ1C,MAAOkD,UAAW,GACxC,kBAAC,OAAD,CACIrD,MAAO,IACP+C,cAAeT,EACfuB,IAAG,eAAUD,EAAQ,GACrB7C,WAAY6C,EAAQ,EACpBE,uBAAuB","file":"static/js/pdf.9879ed46.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 7099;","import React, { useCallback, useEffect, useState } from \"react\";\r\nimport { Document, Page, pdfjs } from \"react-pdf\";\r\nimport { Paper } from \"@material-ui/core\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport { useLocation, useParams, useRouteMatch } from \"react-router\";\r\nimport { getBaseURL } from \"../../middleware/Api\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { toggleSnackbar } from \"../../actions\";\r\nimport { changeSubTitle } from \"../../redux/viewUpdate/action\";\r\nimport pathHelper from \"../../utils/page\";\r\nimport TextLoading from \"../Placeholder/TextLoading\";\r\npdfjs.GlobalWorkerOptions.workerSrc = `//cdn.staticfile.org/pdf.js/${pdfjs.version}/pdf.worker.js`;\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    layout: {\r\n        marginTop: \"30px\",\r\n        marginLeft: theme.spacing(3),\r\n        marginRight: theme.spacing(3),\r\n        [theme.breakpoints.up(1100 + theme.spacing(3) * 2)]: {\r\n            maxWidth: 900,\r\n            marginLeft: \"auto\",\r\n            marginRight: \"auto\",\r\n        },\r\n        marginBottom: 50,\r\n    },\r\n    \"@global\": {\r\n        canvas: {\r\n            width: \"100% !important\",\r\n            height: \"auto !important\",\r\n            borderRadius: 4,\r\n        },\r\n    },\r\n    paper: {\r\n        marginBottom: theme.spacing(3),\r\n    },\r\n}));\r\n\r\nfunction useQuery() {\r\n    return new URLSearchParams(useLocation().search);\r\n}\r\n\r\nexport default function PDFViewer() {\r\n    const math = useRouteMatch();\r\n    const location = useLocation();\r\n    const query = useQuery();\r\n    const { id } = useParams();\r\n\r\n    const [pageNumber, setPageNumber] = useState(1);\r\n\r\n    const dispatch = useDispatch();\r\n    const SetSubTitle = useCallback(\r\n        (title) => dispatch(changeSubTitle(title)),\r\n        [dispatch]\r\n    );\r\n    const ToggleSnackbar = useCallback(\r\n        (vertical, horizontal, msg, color) =>\r\n            dispatch(toggleSnackbar(vertical, horizontal, msg, color)),\r\n        [dispatch]\r\n    );\r\n\r\n    useEffect(() => {\r\n        if (!pathHelper.isSharePage(location.pathname)) {\r\n            const path = query.get(\"p\").split(\"/\");\r\n            SetSubTitle(path[path.length - 1]);\r\n        } else {\r\n            SetSubTitle(query.get(\"name\"));\r\n        }\r\n        // eslint-disable-next-line\r\n    }, [math.params[0], location]);\r\n\r\n    const removeTextLayerOffset = () => {\r\n        const textLayers = document.querySelectorAll(\r\n            \".react-pdf__Page__textContent\"\r\n        );\r\n        textLayers.forEach((layer) => {\r\n            const { style } = layer;\r\n            style.display = \"none\";\r\n        });\r\n    };\r\n\r\n    const classes = useStyles();\r\n    return (\r\n        <div className={classes.layout}>\r\n            <Document\r\n                onLoadSuccess={({ numPages }) => setPageNumber(numPages)}\r\n                onLoadError={(error) => {\r\n                    ToggleSnackbar(\r\n                        \"top\",\r\n                        \"right\",\r\n                        \"PDF 加载失败，\" + error.message,\r\n                        \"error\"\r\n                    );\r\n                }}\r\n                loading={\r\n                    <Paper className={classes.paper} elevation={1}>\r\n                        <TextLoading />\r\n                    </Paper>\r\n                }\r\n                file={\r\n                    getBaseURL() +\r\n                    (pathHelper.isSharePage(location.pathname)\r\n                        ? \"/share/preview/\" +\r\n                          id +\r\n                          (query.get(\"share_path\") !== \"\"\r\n                              ? \"?path=\" +\r\n                                encodeURIComponent(query.get(\"share_path\"))\r\n                              : \"\")\r\n                        : \"/file/preview/\" + query.get(\"id\"))\r\n                }\r\n            >\r\n                {Array.from(new Array(pageNumber), (el, index) => (\r\n                    <Paper className={classes.paper} elevation={1}>\r\n                        <Page\r\n                            width={900}\r\n                            onLoadSuccess={removeTextLayerOffset}\r\n                            key={`page_${index + 1}`}\r\n                            pageNumber={index + 1}\r\n                            renderAnnotationLayer={false}\r\n                        />\r\n                    </Paper>\r\n                ))}\r\n            </Document>\r\n        </div>\r\n    );\r\n}\r\n"],"sourceRoot":""}